import React, { useState, useEffect } from 'react';
import { Trash2, Package, CheckCircle, XCircle, RotateCcw, Trophy, Users, Plus, Minus, BookOpen, ArrowRight } from 'lucide-react';

// Banco de dados com 60 competências constitucionais + Fundamento Legal Exato
const COMPETENCIAS = [
  // UNIÃO
  { texto: "Declarar a guerra e celebrar a paz", resposta: "União", fundamento: "Art. 21, II, CF" },
  { texto: "Emitir moeda", resposta: "União", fundamento: "Art. 21, III, CF" },
  { texto: "Administrar as reservas cambiais do País", resposta: "União", fundamento: "Art. 21, IV, CF" },
  { texto: "Manter o serviço postal e o correio aéreo nacional", resposta: "União", fundamento: "Art. 21, X, CF" },
  { texto: "Explorar os serviços e instalações nucleares de qualquer natureza", resposta: "União", fundamento: "Art. 21, XXIII, CF" },
  { texto: "Organizar e manter a polícia federal, a rodoviária e a ferroviária", resposta: "União", fundamento: "Art. 21, XIV, CF" },
  { texto: "Conceder anistia", resposta: "União", fundamento: "Art. 21, XVII, CF" },
  { texto: "Legislar sobre direito civil, comercial, penal, processual e do trabalho", resposta: "União", fundamento: "Art. 22, I, CF" },
  { texto: "Legislar sobre desapropriação", resposta: "União", fundamento: "Art. 22, II, CF" },
  { texto: "Legislar sobre requisições civis e militares", resposta: "União", fundamento: "Art. 22, III, CF" },
  { texto: "Legislar sobre águas, energia, informática, telecomunicações e radiodifusão", resposta: "União", fundamento: "Art. 22, IV, CF" },
  { texto: "Legislar sobre serviço postal", resposta: "União", fundamento: "Art. 22, V, CF" },
  { texto: "Legislar sobre sistema monetário e de medidas", resposta: "União", fundamento: "Art. 22, VI, CF" },
  { texto: "Legislar sobre política de crédito, câmbio e seguros", resposta: "União", fundamento: "Art. 22, VII, CF" },
  { texto: "Legislar sobre comércio exterior e interestadual", resposta: "União", fundamento: "Art. 22, VIII, CF" },
  { texto: "Legislar sobre diretrizes da política nacional de transportes", resposta: "União", fundamento: "Art. 22, IX, CF" },
  { texto: "Legislar sobre jazidas, minas e outros recursos minerais", resposta: "União", fundamento: "Art. 22, XII, CF" },
  { texto: "Legislar sobre nacionalidade, cidadania e naturalização", resposta: "União", fundamento: "Art. 22, XIII, CF" },
  { texto: "Legislar sobre populações indígenas", resposta: "União", fundamento: "Art. 22, XIV, CF" },
  { texto: "Autorizar e fiscalizar a produção e o comércio de material bélico", resposta: "União", fundamento: "Art. 21, VI, CF" },

  // ESTADO
  { texto: "Explorar diretamente, ou mediante concessão, os serviços locais de gás canalizado", resposta: "Estado", fundamento: "Art. 25, § 2º, CF" },
  { texto: "Instituir regiões metropolitanas, aglomerações urbanas e microrregiões", resposta: "Estado", fundamento: "Art. 25, § 3º, CF" },
  { texto: "Exercer as competências que não lhes sejam vedadas (Competência Residual)", resposta: "Estado", fundamento: "Art. 25, § 1º, CF" },
  { texto: "Legislar concorrentemente sobre direito tributário, financeiro e penitenciário", resposta: "Estado", fundamento: "Art. 24, I, CF" },
  { texto: "Legislar concorrentemente sobre orçamento", resposta: "Estado", fundamento: "Art. 24, II, CF" },
  { texto: "Legislar concorrentemente sobre juntas comerciais", resposta: "Estado", fundamento: "Art. 24, III, CF" },
  { texto: "Legislar concorrentemente sobre custas dos serviços forenses", resposta: "Estado", fundamento: "Art. 24, IV, CF" },
  { texto: "Legislar concorrentemente sobre produção e consumo", resposta: "Estado", fundamento: "Art. 24, V, CF" },
  { texto: "Legislar concorrentemente sobre florestas, caça, pesca e fauna", resposta: "Estado", fundamento: "Art. 24, VI, CF" },
  { texto: "Legislar concorrentemente sobre proteção ao patrimônio histórico e cultural", resposta: "Estado", fundamento: "Art. 24, VII, CF" },
  { texto: "Legislar concorrentemente sobre responsabilidade por dano ao meio ambiente", resposta: "Estado", fundamento: "Art. 24, VIII, CF" },
  { texto: "Legislar concorrentemente sobre educação, cultura, ensino e desporto", resposta: "Estado", fundamento: "Art. 24, IX, CF" },
  { texto: "Legislar concorrentemente sobre criação do juizado de pequenas causas", resposta: "Estado", fundamento: "Art. 24, X, CF" },
  { texto: "Legislar concorrentemente sobre procedimentos em matéria processual", resposta: "Estado", fundamento: "Art. 24, XI, CF" },
  { texto: "Legislar concorrentemente sobre previdência social e defesa da saúde", resposta: "Estado", fundamento: "Art. 24, XII, CF" },
  { texto: "Legislar concorrentemente sobre assistência jurídica e Defensoria pública", resposta: "Estado", fundamento: "Art. 24, XIII, CF" },
  { texto: "Legislar concorrentemente sobre integração social de pessoas com deficiência", resposta: "Estado", fundamento: "Art. 24, XIV, CF" },
  { texto: "Legislar concorrentemente sobre proteção à infância e à juventude", resposta: "Estado", fundamento: "Art. 24, XV, CF" },
  { texto: "Legislar concorrentemente sobre organização, garantias e direitos das polícias civis", resposta: "Estado", fundamento: "Art. 24, XVI, CF" },
  { texto: "Exercer competência legislativa plena inexistindo lei federal sobre normas gerais", resposta: "Estado", fundamento: "Art. 24, § 3º, CF" },

  // MUNICÍPIO
  { texto: "Legislar sobre assuntos de interesse local", resposta: "Município", fundamento: "Art. 30, I, CF" },
  { texto: "Suplementar a legislação federal e a estadual no que couber", resposta: "Município", fundamento: "Art. 30, II, CF" },
  { texto: "Instituir e arrecadar os tributos de sua competência e aplicar suas rendas", resposta: "Município", fundamento: "Art. 30, III, CF" },
  { texto: "Criar, organizar e suprimir distritos, observada a legislação estadual", resposta: "Município", fundamento: "Art. 30, IV, CF" },
  { texto: "Organizar e prestar os serviços públicos de interesse local", resposta: "Município", fundamento: "Art. 30, V, CF" },
  { texto: "Organizar e prestar o serviço de transporte coletivo municipal", resposta: "Município", fundamento: "Art. 30, V, CF" },
  { texto: "Manter programas de educação infantil e de ensino fundamental", resposta: "Município", fundamento: "Art. 30, VI, CF" },
  { texto: "Prestar serviços de atendimento à saúde da população local", resposta: "Município", fundamento: "Art. 30, VII, CF" },
  { texto: "Promover o adequado ordenamento territorial e controle do uso do solo", resposta: "Município", fundamento: "Art. 30, VIII, CF" },
  { texto: "Promover a proteção do patrimônio histórico-cultural local", resposta: "Município", fundamento: "Art. 30, IX, CF" },
  { texto: "Fixar o horário de funcionamento de estabelecimento comercial local", resposta: "Município", fundamento: "Súmula Vinculante 38 (c/c Art. 30, I, CF)" },
  { texto: "Instituir guarda municipal para proteção de seus bens, serviços e instalações", resposta: "Município", fundamento: "Art. 144, § 8º, CF" },
  { texto: "Executar a política de desenvolvimento urbano municipal", resposta: "Município", fundamento: "Art. 182, caput, CF" },
  { texto: "Exigir do proprietário do solo urbano não edificado o adequado aproveitamento", resposta: "Município", fundamento: "Art. 182, § 4º, CF" },
  { texto: "Aprovar o plano diretor (obrigatório para cidades com mais de 20 mil habitantes)", resposta: "Município", fundamento: "Art. 182, § 1º, CF" },
  { texto: "Promover a desapropriação de área urbana por interesse social para reforma urbana", resposta: "Município", fundamento: "Art. 182, § 4º, III, CF" },
  { texto: "Regulamentar o serviço de táxi e transporte por aplicativos no âmbito local", resposta: "Município", fundamento: "Art. 30, I e V, CF (Jurisprudência)" },
  { texto: "Cuidar da limpeza urbana e do manejo de resíduos sólidos em seu território", resposta: "Município", fundamento: "Art. 30, V, CF" },
  { texto: "Conceder e renovar licença de localização e funcionamento para o comércio local", resposta: "Município", fundamento: "Art. 30, I, CF" },
  { texto: "Sinalizar as vias urbanas e regulamentar o trânsito local", resposta: "Município", fundamento: "Art. 30, I, CF" }
];

const shuffleArray = (array) => {
  const newArr = [...array];
  for (let i = newArr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
  }
  return newArr;
};

export default function App() {
  const [gameState, setGameState] = useState('setup');
  const [teams, setTeams] = useState([
    { id: 1, name: 'Equipe Alpha', score: 0, errors: 0 },
    { id: 2, name: 'Equipe Beta', score: 0, errors: 0 }
  ]);
  const [currentTeamIndex, setCurrentTeamIndex] = useState(0);

  const [pool, setPool] = useState([]);
  const [activeCard, setActiveCard] = useState(null);
  const [status, setStatus] = useState('idle'); 
  const [draggedOver, setDraggedOver] = useState(null);
  
  // Novo estado para controlar o Modal de Aprendizado (Flashcard)
  const [feedback, setFeedback] = useState(null); 

  // ---- FUNÇÕES DE SETUP DAS EQUIPES ----
  const handleAddTeam = () => {
    if (teams.length < 3) {
      setTeams([...teams, { id: Date.now(), name: `Equipe ${teams.length + 1}`, score: 0, errors: 0 }]);
    }
  };

  const handleRemoveTeam = (id) => {
    if (teams.length > 2) {
      setTeams(teams.filter(t => t.id !== id));
    }
  };

  const updateTeamName = (id, newName) => {
    setTeams(teams.map(t => t.id === id ? { ...t, name: newName } : t));
  };

  const startGame = () => {
    const resetTeams = teams.map(t => ({ ...t, score: 0, errors: 0 }));
    setTeams(resetTeams);
    setPool(shuffleArray(COMPETENCIAS));
    setActiveCard(null);
    setStatus('idle');
    setCurrentTeamIndex(0);
    setFeedback(null);
    setGameState('playing');
  };

  const backToSetup = () => {
    setGameState('setup');
  };

  // ---- LÓGICA DO JOGO ----
  const drawCard = () => {
    if (pool.length === 0) {
      setGameState('finished');
      return;
    }
    const newPool = [...pool];
    const nextCard = newPool.pop();
    setPool(newPool);
    setActiveCard(nextCard);
    setStatus('idle');
  };

  const advanceTurn = () => {
    setCurrentTeamIndex((prev) => (prev + 1) % teams.length);
    if (pool.length === 0) {
      setGameState('finished');
    }
  };

  const handleGuess = (guess) => {
    if (!activeCard || status !== 'idle') return;

    const isCorrect = activeCard.resposta === guess;
    setStatus(isCorrect ? 'correct' : 'wrong');

    if (isCorrect) {
      setTeams(prev => prev.map((t, i) => i === currentTeamIndex ? { ...t, score: t.score + 1 } : t));
    } else {
      setTeams(prev => prev.map((t, i) => i === currentTeamIndex ? { ...t, errors: t.errors + 1 } : t));
    }

    // Espera a animação do card (cair no balde ou lixo) e abre o Painel Educativo
    setTimeout(() => {
      setFeedback({
        type: isCorrect ? 'correct' : 'wrong',
        card: activeCard
      });
    }, 800);
  };

  const handleNextTurn = () => {
    setActiveCard(null);
    setStatus('idle');
    setFeedback(null);
    advanceTurn();
  };

  // ---- EVENTOS DE DRAG AND DROP ----
  const handleDragStart = (e) => {
    if (status !== 'idle') e.preventDefault();
    e.dataTransfer.setData('text/plain', activeCard?.resposta);
  };

  const handleDragOver = (e, bucketName) => {
    e.preventDefault();
    if (status === 'idle') {
      setDraggedOver(bucketName);
    }
  };

  const handleDragLeave = () => {
    setDraggedOver(null);
  };

  const handleDrop = (e, bucketName) => {
    e.preventDefault();
    setDraggedOver(null);
    handleGuess(bucketName);
  };

  // ---- TELAS AUXILIARES (SETUP e FINISHED) mantidas iguais... ----
  if (gameState === 'setup') {
    return (
      <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4 font-sans">
        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
          <div className="flex items-center justify-center gap-3 mb-6">
            <Users className="w-8 h-8 text-blue-600" />
            <h1 className="text-2xl font-black text-slate-800 uppercase text-center">Configurar Equipes</h1>
          </div>
          <p className="text-slate-500 text-center mb-6 text-sm">Jogue com 2 ou 3 equipes. As rodadas serão alternadas.</p>
          <div className="space-y-4 mb-6">
            {teams.map((team, index) => (
              <div key={team.id} className="flex items-center gap-2">
                <span className="font-bold text-slate-400 w-6">{index + 1}.</span>
                <input 
                  type="text" 
                  value={team.name}
                  onChange={(e) => updateTeamName(team.id, e.target.value)}
                  maxLength={15}
                  className="flex-1 bg-slate-100 border border-slate-300 rounded-lg px-4 py-3 font-bold text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Nome da Equipe"
                />
                {teams.length > 2 && (
                  <button onClick={() => handleRemoveTeam(team.id)} className="p-3 bg-red-100 text-red-600 rounded-lg hover:bg-red-200"><Minus className="w-5 h-5" /></button>
                )}
              </div>
            ))}
          </div>
          {teams.length < 3 && (
            <button onClick={handleAddTeam} className="w-full mb-6 py-3 border-2 border-dashed border-blue-400 text-blue-600 font-bold rounded-xl flex items-center justify-center gap-2 hover:bg-blue-50 transition-colors">
              <Plus className="w-5 h-5" /> Adicionar 3ª Equipe
            </button>
          )}
          <button onClick={startGame} disabled={teams.some(t => t.name.trim() === '')} className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed text-white font-black py-4 px-6 rounded-xl transition-all uppercase tracking-wider text-lg shadow-lg">
            Começar Jogo
          </button>
        </div>
      </div>
    );
  }

  if (gameState === 'finished') {
    const sortedTeams = [...teams].sort((a, b) => b.score - a.score);
    const winner = sortedTeams[0];
    const isTie = sortedTeams.length > 1 && sortedTeams[0].score === sortedTeams[1].score;

    return (
      <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4 font-sans">
        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center">
          <Trophy className="w-24 h-24 text-yellow-500 mx-auto mb-4" />
          <h1 className="text-3xl font-black text-slate-800 mb-2 uppercase">Fim de Jogo!</h1>
          {isTie ? <p className="text-xl font-bold text-blue-600 mb-6">Tivemos um empate!</p> : <p className="text-xl font-bold text-green-600 mb-6">Vitória da {winner.name}!</p>}
          <div className="space-y-3 mb-8">
            {sortedTeams.map((team, index) => (
              <div key={team.id} className={`flex items-center justify-between p-4 rounded-xl border-2 ${index === 0 && !isTie ? 'border-yellow-400 bg-yellow-50' : 'border-slate-200 bg-slate-50'}`}>
                <div className="flex items-center gap-3">
                  <span className={`font-black text-xl ${index === 0 && !isTie ? 'text-yellow-600' : 'text-slate-400'}`}>{index + 1}º</span>
                  <span className="font-bold text-lg text-slate-700">{team.name}</span>
                </div>
                <div className="flex gap-4 text-sm font-bold">
                  <span className="text-green-600">{team.score} Acertos</span>
                  <span className="text-red-500">{team.errors} Erros</span>
                </div>
              </div>
            ))}
          </div>
          <div className="flex gap-4">
            <button onClick={startGame} className="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl transition-all flex items-center justify-center gap-2">
              <RotateCcw className="w-5 h-5" /> Revanche
            </button>
            <button onClick={backToSetup} className="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-4 px-4 rounded-xl transition-all">
              Mudar Equipes
            </button>
          </div>
        </div>
      </div>
    );
  }

  // ---- TELA PRINCIPAL DO JOGO (PLAYING) ----
  const activeTeam = teams[currentTeamIndex];

  return (
    <div className="min-h-screen bg-slate-100 flex flex-col font-sans select-none">
      
      {/* HEADER MULTIPLAYER */}
      <header className="bg-slate-900 text-white p-4 shadow-md z-10 border-b-4 border-slate-800">
        <div className="max-w-6xl mx-auto flex flex-col lg:flex-row items-center justify-between gap-6">
          <div className="text-center lg:text-left">
            <h1 className="text-2xl font-black uppercase tracking-wider">De Quem é a Competência?</h1>
            <p className="text-slate-400 text-sm">Direito Constitucional - CF/88</p>
          </div>
          <div className="flex flex-wrap justify-center gap-3 w-full lg:w-auto">
            {teams.map((team, index) => {
              const isActive = index === currentTeamIndex;
              return (
                <div key={team.id} className={`flex flex-col px-4 py-2 rounded-lg border-2 transition-all min-w-[140px] ${isActive ? 'bg-blue-900/80 border-blue-400 scale-105 shadow-lg shadow-blue-500/20' : 'bg-slate-800 border-slate-700 opacity-70'}`}>
                  <div className="flex justify-between items-center mb-1">
                    <span className={`text-xs font-black uppercase tracking-wider ${isActive ? 'text-blue-300' : 'text-slate-400'}`}>{team.name}</span>
                    {isActive && <div className="w-2 h-2 rounded-full bg-blue-400 animate-pulse" />}
                  </div>
                  <div className="flex justify-between text-sm font-bold">
                    <span className="text-green-400">{team.score} <CheckCircle className="inline w-3 h-3 mb-0.5"/></span>
                    <span className="text-red-400">{team.errors} <XCircle className="inline w-3 h-3 mb-0.5"/></span>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </header>

      {/* ÁREA DO JOGO */}
      <main className="flex-1 max-w-6xl w-full mx-auto p-4 sm:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 items-start relative">
        
        {/* CAIXINHA & CARD ATUAL (Lado Esquerdo) */}
        <div className="lg:col-span-4 flex flex-col gap-6 items-center w-full">
          <div className={`w-full py-3 px-4 rounded-xl text-center font-black uppercase tracking-wider shadow-sm transition-colors ${status === 'idle' ? 'bg-blue-600 text-white' : 'bg-slate-300 text-slate-500'}`}>
            Vez da: {activeTeam.name}
          </div>

          <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 w-full text-center">
            <button
              onClick={drawCard}
              disabled={!!activeCard || status !== 'idle'}
              className={`w-full relative group p-8 rounded-xl border-4 border-dashed transition-all flex flex-col items-center gap-4
                ${(!activeCard && status === 'idle') 
                  ? 'border-blue-400 bg-blue-50 hover:bg-blue-100 cursor-pointer text-blue-700 shadow-inner' 
                  : 'border-slate-300 bg-slate-100 text-slate-400 cursor-not-allowed'}`}
            >
              <Package className={`w-16 h-16 ${(!activeCard && status === 'idle') ? 'animate-bounce' : ''}`} />
              <span className="font-bold text-lg uppercase tracking-wide">
                {pool.length > 0 ? "Sortear Competência" : "Fim dos Casos"}
              </span>
              <span className="text-sm opacity-80 font-medium">Restam {pool.length} casos no fundo</span>
            </button>
          </div>

          {/* CARD ATIVO */}
          <div className="h-64 w-full flex items-center justify-center">
            {activeCard && (
              <div 
                draggable={status === 'idle'}
                onDragStart={handleDragStart}
                className={`w-full max-w-sm bg-yellow-50 p-6 rounded-xl shadow-lg border-2 border-yellow-300 cursor-grab active:cursor-grabbing transform transition-all duration-500 flex flex-col gap-4 items-center text-center
                  ${status === 'correct' ? 'scale-0 opacity-0 bg-green-100 border-green-400' : ''}
                  ${status === 'wrong' ? 'translate-x-[200px] lg:translate-x-[400px] scale-50 opacity-0 rotate-12 bg-red-100 border-red-400' : 'scale-100 opacity-100'}
                `}
              >
                <div className="text-xs font-black text-yellow-600/80 uppercase tracking-widest mb-2 border-b-2 border-yellow-200/50 w-full pb-2">Atribuição</div>
                <p className="text-lg sm:text-xl font-bold text-slate-800 leading-snug">"{activeCard.texto}"</p>
                <div className="mt-auto pt-4 text-xs text-slate-500 font-bold flex flex-col items-center gap-1 uppercase tracking-wide">
                  <span className="text-blue-600">{activeTeam.name}</span>
                  <span>Arraste ou Clique no Balde</span>
                </div>
              </div>
            )}
            {!activeCard && status === 'idle' && (
              <div className="text-slate-400 font-medium border-2 border-dashed border-slate-300 p-8 rounded-xl w-full text-center">
                Aperte a caixa para sortear a vez da <br/><span className="text-blue-600 font-bold uppercase">{activeTeam.name}</span>.
              </div>
            )}
          </div>
        </div>

        {/* BALDES DE COMPETÊNCIA (Centro) */}
        <div className="lg:col-span-5 grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-1 gap-4 lg:gap-6">
          {['União', 'Estado', 'Município'].map((esfera) => {
            const themes = {
              União: { base: 'bg-blue-100 border-blue-300', over: 'bg-blue-200 border-blue-500', icon: 'bg-blue-600', text: 'text-blue-900', letter: 'U' },
              Estado: { base: 'bg-orange-100 border-orange-300', over: 'bg-orange-200 border-orange-500', icon: 'bg-orange-500', text: 'text-orange-900', letter: 'E' },
              Município: { base: 'bg-purple-100 border-purple-300', over: 'bg-purple-200 border-purple-500', icon: 'bg-purple-600', text: 'text-purple-900', letter: 'M' }
            };
            const theme = themes[esfera];
            const isOver = draggedOver === esfera;

            return (
              <button 
                key={esfera}
                onClick={() => handleGuess(esfera)}
                onDragOver={(e) => handleDragOver(e, esfera)}
                onDragLeave={handleDragLeave}
                onDrop={(e) => handleDrop(e, esfera)}
                className={`flex flex-col items-center justify-center p-6 rounded-2xl border-4 transition-all w-full
                  ${activeCard ? 'cursor-pointer hover:scale-105 hover:shadow-lg' : 'opacity-70 cursor-default'}
                  ${isOver ? `${theme.over} scale-105 shadow-xl` : theme.base}
                `}
              >
                <div className={`w-16 h-16 ${theme.icon} rounded-full flex items-center justify-center mb-3 shadow-inner`}>
                  <span className="text-white font-black text-2xl">{theme.letter}</span>
                </div>
                <h2 className={`text-xl font-black ${theme.text} uppercase`}>{esfera}</h2>
              </button>
            )
          })}
        </div>

        {/* LIXO DO ERRO (Lado Direito) */}
        <div className="lg:col-span-3 flex flex-col justify-center h-full relative">
          <div className={`p-8 rounded-2xl border-4 flex flex-col items-center text-center transition-all duration-300 z-10 relative
            ${status === 'wrong' ? 'bg-red-200 border-red-600 scale-105 shadow-2xl' : 'bg-slate-200 border-slate-300'}
          `}>
            <Trash2 className={`w-20 h-20 mb-4 transition-all duration-300 ${status === 'wrong' ? 'text-red-600 animate-bounce' : 'text-slate-400'}`} />
            <h2 className={`text-2xl font-black uppercase mb-2 ${status === 'wrong' ? 'text-red-700' : 'text-slate-500'}`}>Lixo do Erro</h2>
            <p className="text-sm font-medium text-slate-500 mt-2">Erros da equipe caem direto aqui.</p>
          </div>
        </div>

      </main>

      {/* OVERLAY / MODAL EDUCATIVO DE FLASHCARD */}
      {feedback && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
          <div className={`bg-white border-8 rounded-3xl p-6 md:p-8 max-w-lg w-full shadow-2xl flex flex-col items-center text-center transform transition-all duration-300 scale-100
            ${feedback.type === 'correct' ? 'border-green-500' : 'border-red-500'}
          `}>
            
            {/* Ícone de Sucesso ou Erro */}
            {feedback.type === 'correct' ? (
               <CheckCircle className="w-20 h-20 text-green-500 mb-4" />
            ) : (
               <XCircle className="w-20 h-20 text-red-500 mb-4" />
            )}
            
            <h2 className={`text-3xl font-black uppercase mb-2 tracking-wide ${feedback.type === 'correct' ? 'text-green-600' : 'text-red-600'}`}>
              {feedback.type === 'correct' ? 'Acertou!' : 'Ops, Errou!'}
            </h2>

            <div className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 mb-4">
              <p className="text-slate-700 font-medium italic">"{feedback.card.texto}"</p>
            </div>

            <div className="flex flex-col gap-1 w-full bg-slate-100 rounded-xl p-4 mb-4 border border-slate-200">
              <span className="text-sm font-bold text-slate-500 uppercase">A Competência é:</span>
              <span className={`text-2xl font-black uppercase tracking-wider
                 ${feedback.card.resposta === 'União' ? 'text-blue-600' : feedback.card.resposta === 'Estado' ? 'text-orange-600' : 'text-purple-600'}
              `}>
                {feedback.card.resposta}
              </span>
            </div>

            {/* CAIXA DE FUNDAMENTO LEGAL (Ouro/Amarelo) */}
            <div className="w-full bg-yellow-100 border-2 border-yellow-300 rounded-xl p-4 mb-8 relative shadow-inner">
              <BookOpen className="w-8 h-8 text-yellow-500 absolute -top-4 left-1/2 -translate-x-1/2 bg-yellow-100 rounded-full p-1 border-2 border-yellow-300" />
              <span className="text-xs font-black text-yellow-700 uppercase tracking-widest block mb-2 mt-2">Fundamento Legal</span>
              <span className="text-xl font-black text-yellow-900">
                {feedback.card.fundamento}
              </span>
            </div>

            <button 
              onClick={handleNextTurn}
              className={`w-full text-white font-black py-4 px-6 rounded-xl transition-all uppercase tracking-wider text-lg shadow-lg flex items-center justify-center gap-2 hover:scale-105 active:scale-95
                ${feedback.type === 'correct' ? 'bg-green-600 hover:bg-green-700 shadow-green-600/30' : 'bg-red-600 hover:bg-red-700 shadow-red-600/30'}
              `}
            >
              Próxima Rodada <ArrowRight className="w-6 h-6" />
            </button>
          </div>
        </div>
      )}

    </div>
  );
}
